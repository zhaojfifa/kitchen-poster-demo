<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>厨具海报生成 · 两步四区模板（稳定版）</title>
<style>
  :root{--bg:#f6f7fa;--ink:#0f172a;--muted:#64748b;--line:#e2e8f0;--shadow:0 6px 24px rgba(0,0,0,.08)}
  *{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.5 system-ui,"Noto Sans SC",sans-serif}
  .wrap{max-width:1120px;margin:auto;padding:24px}
  .card{background:#fff;border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow);padding:18px}
  .tabs{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0 18px}
  .tab{padding:10px 14px;border:2px solid var(--line);border-radius:14px;background:#fff;text-align:left;cursor:pointer}
  .tab.active{border-color:#111827;box-shadow:0 0 0 4px rgba(17,24,39,.08)}
  .row{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  label{font-weight:600;margin:8px 0 6px;display:block}
  input[type=file]{display:block}
  .preview{margin-top:6px;background:#f1f5f9;border:1px dashed #cbd5e1;border-radius:12px;display:grid;place-items:center;overflow:hidden;aspect-ratio:16/9}
  .preview img{max-width:100%;max-height:100%;object-fit:contain}
  .thumbs{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
  .thumbs img{width:100%;height:72px;object-fit:cover;border-radius:8px;border:1px solid #cbd5e1}
  .controls{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:8px}
  select,input[type=text],textarea{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:12px;background:#fff}
  textarea{min-height:110px;resize:vertical}
  .btn{border:0;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
  .btn.dark{background:#111827;color:#fff}.btn.green{background:#059669;color:#fff}.btn.indigo{background:#4f46e5;color:#fff}
  canvas{width:100%;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);background:#fff}
  .hint{color:var(--muted);font-size:12px;margin-left:6px}
  .hidden{display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1 style="margin:0 0 6px">厨具海报生成 · 模板化（四区）</h1>
  <div style="color:#64748b;margin-bottom:8px">两步：素材上传 → 海报生成；四区：Banner（Logo+主题）/ 左图4:6 / 右厨具+特性引线 / 底部产品列表（标题与说明）。</div>

  <div class="tabs">
    <button id="tab1" class="tab active">1. 素材上传</button>
    <button id="tab2" class="tab">2. 海报生成</button>
  </div>

  <section id="step1" class="card">
    <div class="row">
      <div>
        <label>Logo（用于 Banner 左侧）</label>
        <input id="imgLogo" type="file" accept="image/*"/>
        <div class="preview" style="aspect-ratio:3/1"><img id="pvLogo" alt=""></div>
        <button id="pickLogo" class="btn" style="margin-top:8px;background:#fff;border:1px solid #d1d5db">从 Logo 取色 → Banner</button>
      </div>
      <div>
        <label>左侧菜品/场景图（30% 宽）</label>
        <input id="imgLeft" type="file" accept="image/*"/>
        <div class="preview"><img id="pvLeft" alt=""></div>
      </div>
      <div>
        <label>右侧厨具主图（70% 宽）</label>
        <input id="imgRight" type="file" accept="image/*"/>
        <div class="preview"><img id="pvRight" alt=""></div>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label>Banner 主题</label>
        <input id="txtTitle" type="text" placeholder="专业级厨具"/>
        <label>Banner 副标题</label>
        <input id="txtSub" type="text" placeholder="美味只需一个按钮"/>
        <label>右侧厨具上方标题</label>
        <input id="txtRightTitle" type="text" placeholder="双灶台 · 高效燃烧"/>
        <label>厨具特性（每行一条）</label>
        <textarea id="txtFeatures">热电偶熄火保护
铸铁锅架
不锈钢面板
便捷旋钮
高效燃烧器</textarea>
      </div>
      <div>
        <label>产品列表图（多选 ≤8）</label>
        <input id="imgList" type="file" accept="image/*" multiple/>
        <div id="pvList" class="thumbs" style="margin-top:6px"></div>
        <label style="margin-top:10px">产品列表标题</label>
        <input id="txtListTitle" type="text" placeholder="系列产品一览"/>
        <label>产品说明文字（与图片一一对应，每行一条，可留空）</label>
        <textarea id="txtListCaps"></textarea>
      </div>
      <div>
        <label>Banner 主色（左）</label>
        <input id="clrL" type="color" value="#b8001f"/>
        <label>Banner 次色（右）</label>
        <input id="clrR" type="color" value="#f8e9ed"/>
        <label>Banner 高度（%）</label>
        <input id="rngBH" type="range" min="10" max="22" value="14"/>
        <div class="hint">中文字号规则：主标题小两号、副标题小一号</div>
      </div>
    </div>

    <div style="margin-top:10px">
      <button id="go2" class="btn dark">下一步：生成海报</button>
      <span class="hint">确认素材与文案后继续</span>
    </div>
  </section>

  <section id="step2" class="card hidden">
    <div class="controls">
      <div>
        <label>海报尺寸</label>
        <select id="selSize">
          <option value="1240x1754">1240×1754（A4竖 预览）</option>
          <option value="2480x3508">2480×3508（A4竖 高清）</option>
          <option value="1080x1920">1080×1920（竖屏）</option>
        </select>
      </div>
      <div>
        <label>左:右 比例</label>
        <select id="selSplit">
          <option value="3:7">30% : 70%</option>
          <option value="4:6" selected>40% : 60%</option>
          <option value="5:5">50% : 50%</option>
        </select>
      </div>
      <div>
        <label>底部最多展示</label>
        <select id="selMax">
          <option value="4">4 张</option>
          <option value="6" selected>6 张</option>
          <option value="8">8 张</option>
        </select>
      </div>
      <div>
        <label>风格模板</label>
        <select id="selTheme">
          <option value="classic" selected>经典（均衡）</option>
          <option value="bold">醒目（标题更大）</option>
          <option value="tech">技术感（网格）</option>
        </select>
      </div>
      <div style="align-self:end"><button id="btnRender" class="btn dark" style="width:100%">生成海报预览</button></div>
    </div>

    <div style="margin:8px 0 12px">
      <button id="btnPNG" class="btn green">下载 PNG</button>
      <button id="btnHTML" class="btn indigo">导出可发布 HTML</button>
    </div>

    <canvas id="cv"></canvas>
  </section>
</div>

<script>
(function(){
'use strict';
const $=id=>document.getElementById(id);
const on=(el,ev,fn)=>el.addEventListener(ev,fn);
let lang='zh'; // 中文：主标题-2号，副标题-1号
let logoImg=null,leftImg=null,rightImg=null,listImgs=[];

// Tabs
function activate(step){ const s1=$('step1'), s2=$('step2'); const t1=$('tab1'), t2=$('tab2'); if(step===1){ s1.classList.remove('hidden'); s2.classList.add('hidden'); t1.classList.add('active'); t2.classList.remove('active'); } else { s2.classList.remove('hidden'); s1.classList.add('hidden'); t2.classList.add('active'); t1.classList.remove('active'); }}
on($('tab1'),'click',()=>activate(1)); on($('tab2'),'click',()=>activate(2)); on($('go2'),'click',()=>activate(2));

// Image upload + preview
function bindPreview(input, imgEl, store){ on(input,'change',()=>{ const f=input.files&&input.files[0]; if(!f) return; const url=URL.createObjectURL(f); imgEl.src=url; const im=new Image(); im.onload=()=>{ store(im); }; im.src=url; }); }
bindPreview($('imgLogo'),$('pvLogo'),im=>logoImg=im);
bindPreview($('imgLeft'),$('pvLeft'),im=>leftImg=im);
bindPreview($('imgRight'),$('pvRight'),im=>rightImg=im);

on($('imgList'),'change',()=>{ listImgs=[]; const wrap=$('pvList'); wrap.innerHTML=''; [...$('imgList').files].slice(0,8).forEach(f=>{ const url=URL.createObjectURL(f); const im=new Image(); im.onload=()=>listImgs.push(im); im.src=url; const t=document.createElement('img'); t.src=url; wrap.appendChild(t); }); });

// Pick colors from logo
on($('pickLogo'),'click',()=>{ if(!logoImg) return alert('请先上传 Logo'); const c=document.createElement('canvas'),x=c.getContext('2d'); c.width=logoImg.width; c.height=logoImg.height; x.drawImage(logoImg,0,0); const d=x.getImageData(0,0,c.width,c.height).data; let r=0,g=0,b=0,n=0; for(let i=0;i<d.length;i+=4){ const a=d[i+3]; if(a<16) continue; r+=d[i]; g+=d[i+1]; b+=d[i+2]; n++; } if(!n) return; r=Math.round(r/n); g=Math.round(g/n); b=Math.round(b/n); const hex=(R,G,B)=>('#'+[R,G,B].map(v=>('0'+v.toString(16)).slice(-2)).join('')); $('clrL').value=hex(r,g,b); $('clrR').value=hex(Math.min(255,Math.round(r*0.85+255*0.15)),Math.min(255,Math.round(g*0.85+255*0.15)),Math.min(255,Math.round(b*0.85+255*0.15))); });

// Text & theme
function TP(){ return { title: $('txtTitle').value||'专业级厨具', sub:$('txtSub').value||'美味只需一个按钮', rightTitle:$('txtRightTitle').value||'双灶台 · 高效燃烧', features: ($('txtFeatures').value||'').split(/
+/).filter(Boolean).slice(0,8), listTitle: $('txtListTitle').value||'系列产品一览', captions: ($('txtListCaps').value||'').split(/
+/).map(s=>s.trim()) }; }
function TH(){ const t=$('selTheme').value; let th=(t==='bold')?{title:.50,sub:.25,right:.036,feature:.024,radius:22,grid:false}:{title:.50,sub:.24,right:.032,feature:.022,radius:18,grid:(t==='tech')}; if(lang==='zh'){ th.title*=.92; th.sub*=.96; } return th; }

// Canvas helpers
const cv=$('cv'); const ctx=cv.getContext('2d');
const RR=(x,y,w,h,r)=>{const rr=Math.min(r,w/2,h/2);ctx.beginPath();ctx.moveTo(x+rr,y);ctx.arcTo(x+w,y,x+w,y+h,rr);ctx.arcTo(x+w,y+h,x,y+h,rr);ctx.arcTo(x,y+h,x,y,rr);ctx.arcTo(x,y,x+w,y,rr);ctx.closePath();};
const drawContain=(img,x,y,w,h)=>{const ir=img.width/img.height, ar=w/h;let dw,dh,dx,dy;if(ir>ar){dh=h;dw=dh*ir;dx=x+(w-dw)/2;dy=y;}else{dw=w;dh=dw/ir;dx=x;dy=y+(h-dh)/2;}ctx.drawImage(img,dx,dy,dw,dh);};

function dashedLink(tx,ty,ax,ay,i){
  ctx.save();
  const styles=[[6,6],[8,5],[5,7],[10,6]];
  ctx.setLineDash(styles[i%styles.length]);
  ctx.strokeStyle='rgba(15,23,42,.7)';
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(tx,ty);
  const wig=30+(i%5)*12;
  const mx=(tx+ax)/2+(i%2?-wig:wig);
  const my=(ty+ay)/2+(i%3===0?wig*.6:-wig*.4);
  ctx.quadraticCurveTo(mx,my,ax,ay);
  ctx.stroke();
  ctx.setLineDash([]);
  // endpoints
  ctx.fillStyle='rgba(15,23,42,.85)';
  ctx.beginPath(); ctx.arc(tx,ty,3,0,Math.PI*2); ctx.fill();
  // arrowhead near anchor
  const ang=Math.atan2(ay-my, ax-mx);
  const ah=9;
  ctx.beginPath();
  ctx.moveTo(ax,ay);
  ctx.lineTo(ax - ah*Math.cos(ang - Math.PI/6), ay - ah*Math.sin(ang - Math.PI/6));
  ctx.lineTo(ax - ah*Math.cos(ang + Math.PI/6), ay - ah*Math.sin(ang + Math.PI/6));
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}
function badge(x0,y0,n){ ctx.save(); ctx.fillStyle='#0f172a'; ctx.beginPath(); ctx.arc(x0,y0,10,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#fff'; ctx.font='700 12px system-ui'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(String(n),x0,y0+.5); ctx.restore(); }

function render(){ const [W,H]=$('selSize').value.split('x').map(Number); cv.width=W; cv.height=H; const pad=Math.round(W*.035), gap=Math.round(W*.02); const th=TH(); const titlePack=TP();
  // bg
  ctx.fillStyle='#fff'; ctx.fillRect(0,0,W,H);
  // banner
  const bh=Math.round(H*(Number($('rngBH').value)/100)); const g=ctx.createLinearGradient(0,0,W,0); g.addColorStop(0,$('clrL').value); g.addColorStop(1,$('clrR').value); ctx.fillStyle=g; ctx.fillRect(0,0,W,bh);
  if(logoImg){ const lh=Math.min(bh*.72, Math.round(W*.08)); const lw=lh*(logoImg.width/logoImg.height); const lx=pad, ly=Math.round((bh-lh)/2); ctx.save(); RR(lx,ly,lw,lh,8); ctx.clip(); drawContain(logoImg,lx,ly,lw,lh); ctx.restore(); }
  ctx.fillStyle='#fff'; ctx.textBaseline='alphabetic'; ctx.font=`900 ${Math.round(bh*TH().title)}px system-ui, 'Noto Sans SC'`; ctx.fillText(titlePack.title, pad+(logoImg?Math.round(bh*.85):0)+16, Math.round(bh*.66)); ctx.fillStyle='rgba(255,255,255,.92)'; ctx.font=`400 ${Math.round(bh*TH().sub)}px system-ui, 'Noto Sans SC'`; ctx.fillText(titlePack.sub, pad+(logoImg?Math.round(bh*.85):0)+16, Math.round(bh*.92));
  // layout
  const bodyTop=bh+pad, bodyH=H-bh-pad*2; const listH=Math.round(bodyH*.30); const topH=bodyH-listH-gap; let [L,R]=$('selSplit').value.split(':').map(Number); const total=L+R; L/=total; R/=total; const leftW=Math.round((W-pad*2-gap)*L), rightW=Math.round((W-pad*2-gap)*R);
  // left block
  const leftX=pad,leftY=bodyTop,leftH=topH; ctx.save(); RR(leftX,leftY,leftW,leftH,18); ctx.clip(); if(leftImg){ drawContain(leftImg,leftX,leftY,leftW,leftH);} else { ctx.fillStyle='#f1f5f9'; ctx.fillRect(leftX,leftY,leftW,leftH); ctx.fillStyle='#64748b'; ctx.font=`600 ${Math.round(W*.02)}px system-ui`; ctx.fillText('上传左侧菜品/场景图', leftX+20, leftY+40);} ctx.restore();
  // right block
  const rightX=pad+leftW+gap,rightY=bodyTop,rightH=topH; ctx.save(); RR(rightX,rightY,rightW,rightH,18); ctx.clip(); ctx.fillStyle='#f8fafc'; ctx.fillRect(rightX,rightY,rightW,rightH); if(TH().grid){ ctx.save(); ctx.strokeStyle='rgba(2,6,23,.06)'; for(let gx=rightX;gx<rightX+rightW;gx+=16){ ctx.beginPath(); ctx.moveTo(gx,rightY); ctx.lineTo(gx,rightY+rightH); ctx.stroke(); } for(let gy=rightY;gy<rightY+rightH;gy+=16){ ctx.beginPath(); ctx.moveTo(rightX,gy); ctx.lineTo(rightX+rightW,gy); ctx.stroke(); } ctx.restore(); }
  ctx.fillStyle='#0f172a'; ctx.font=`800 ${Math.round(W*TH().right)}px system-ui, 'Noto Sans SC'`; ctx.fillText(titlePack.rightTitle, rightX+Math.round(rightW*.08), rightY+Math.round(rightH*.14));
  if(rightImg){ const px=rightX+Math.round(rightW*.1), pw=rightW-Math.round(rightW*.2), ph=pw*(rightImg.height/rightImg.width), py=rightY+Math.round(rightH*.18); drawContain(rightImg,px,py,pw,ph);
    const anchors=[{x:px+pw*.2,y:py+ph*.22},{x:px+pw*.78,y:py+ph*.18},{x:px+pw*.25,y:py+ph*.82},{x:px+pw*.83,y:py+ph*.72},{x:px+pw*.5,y:py+ph*.45},{x:px+pw*.12,y:py+ph*.58},{x:px+pw*.9,y:py+ph*.33},{x:px+pw*.62,y:py+ph*.9}];
    const spots=[{x:rightX+28,y:rightY+48},{x:rightX+rightW-300,y:rightY+36},{x:rightX+28,y:rightY+rightH-36},{x:rightX+rightW-300,y:rightY+rightH-44},{x:rightX+28,y:rightY+rightH/2-6},{x:rightX+rightW-320,y:rightY+rightH/2+8},{x:rightX+rightW-320,y:rightY+rightH*.30},{x:rightX+60,y:rightY+rightH*.28}];
    ctx.fillStyle='#0f172a'; ctx.font=`600 ${Math.round(W*TH().feature)}px system-ui, 'Noto Sans SC'`;
    TP().features.forEach((t,i)=>{ if(i>=anchors.length) return; const a=anchors[i], s=spots[i]; badge(s.x-14,s.y-10,i+1); ctx.fillText(t,s.x,s.y); dashedLink(s.x-6,s.y-12,a.x,a.y,i); });
  } else { ctx.fillStyle='#e2e8f0'; ctx.fillRect(rightX,rightY,rightW,rightH); }
  ctx.restore();
  // bottom list: title down one line + centered; captions down one line under images
  const titleY=rightY+rightH+gap+Math.round(W*.02); ctx.fillStyle='#0f172a'; ctx.textAlign='center'; ctx.font=`800 ${Math.round(W*.03)}px system-ui, 'Noto Sans SC'`; ctx.fillText(titlePack.listTitle, W/2, titleY); ctx.textAlign='left';
  const listX=pad, listW=W-pad*2, listY=titleY+Math.round(W*.02); const maxItems=Number($('selMax').value); const items=listImgs.slice(0,maxItems); const cols=Math.min(items.length||4,maxItems); const spacing=Math.round(listW*.015); const cellW=Math.floor((listW - spacing*(cols-1)) / Math.max(cols,1)); const hImg=Math.min(Math.round(W*.16),(H-listY-pad));
  items.forEach((img,i)=>{ const x0=listX+i*(cellW+spacing), y0=listY; ctx.save(); RR(x0,y0,cellW,hImg,12); ctx.clip(); drawContain(img,x0,y0,cellW,hImg); ctx.restore(); });
  // captions
  if(items.length){ ctx.fillStyle='#0f172a'; ctx.textAlign='center'; ctx.font=`500 ${Math.round(W*.018)}px system-ui, 'Noto Sans SC'`; const gapCap=Math.round(W*.024); items.forEach((img,i)=>{ const x0=listX+i*(cellW+spacing); const cx=x0+cellW/2; const cy=listY+hImg+gapCap; const t=TP().captions[i]||''; if(t){ ctx.fillText(t,cx,cy); } }); ctx.textAlign='left'; }
}

on($('btnRender'),'click',render);
on($('btnPNG'),'click',()=>{ if(!cv.width) render(); const a=document.createElement('a'); a.href=cv.toDataURL('image/png'); a.download='poster.png'; a.click(); });

on($('btnHTML'),'click',()=>{
  function toData(im){ try{ if(!im) return ''; const c=document.createElement('canvas'),x=c.getContext('2d'); c.width=im.width; c.height=im.height; x.drawImage(im,0,0); return c.toDataURL('image/png'); }catch(e){ return ''; } }
  const payload={ lang, fields:{ cn:{ title: $('txtTitle').value, sub:$('txtSub').value, rightTitle:$('txtRightTitle').value, features: $('txtFeatures').value, listTitle:$('txtListTitle').value, captions:$('txtListCaps').value } }, options:{ size:$('selSize').value, split:$('selSplit').value, bannerL:$('clrL').value, bannerR:$('clrR').value, bannerH:$('rngBH').value, max:$('selMax').value, theme:$('selTheme').value }, images:{ logo:toData(logoImg), left:toData(leftImg), right:toData(rightImg), list:listImgs.slice(0,8).map(toData) } };
  const Pjson=JSON.stringify(payload).replace(/</g,'\u003C');
  const parts=[]; parts.push('<!doctype html><html lang="zh-CN"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Poster</title><style>html,body{margin:0;background:#0f172a;color:#e2e8f0;font-family:system-ui,\'Noto Sans SC\'} .wrap{min-height:100vh;display:grid;place-items:center;padding:24px} canvas{max-width:min(92vw,1100px);height:auto;border-radius:12px;background:#fff}</style></head><body><div class="wrap"><canvas id="c"></canvas></div>');
  parts.push('<scr'+'ipt>(function(){"use strict"; const P='+Pjson+'; const c=document.getElementById("c"),x=c.getContext("2d"); function parse(v){const s=v.split("x").map(Number);return{W:s[0],H:s[1]}} function wrap(s){return (s||"").split(/\
+/).filter(Boolean)} function th(){let t=P.options.theme||"classic";let o=(t==="bold")?{title:.50,sub:.25,right:.036,feature:.024}:(t==="tech")?{title:.50,sub:.24,right:.032,feature:.020}:{title:.50,sub:.24,right:.032,feature:.022}; if(P.lang==="zh"){o.title*=.92;o.sub*=.96;} return o;} function draw(src,a,b,w,h){if(!src)return;let i=new Image();i.src=src;i.onload=()=>{const ir=i.width/i.height,ar=w/h;let dw,dh,dx,dy;if(ir>ar){dh=h;dw=dh*ir;dx=a+(w-dw)/2;dy=b;}else{dw=w;dh=dw/ir;dx=a;dy=b+(h-dh)/2;}x.drawImage(i,dx,dy,dw,dh);};} function rr(a,b,w,h,r){const R=Math.min(r,w/2,h/2);x.beginPath();x.moveTo(a+R,b);x.arcTo(a+w,b,a+w,b+h,R);x.arcTo(a+w,b+h,a,b+h,R);x.arcTo(a,b+h,a,b,R);x.arcTo(a,b,a+w,b,R);x.closePath();}
  function render(){const S=parse(P.options.size); c.width=S.W; c.height=S.H; const pad=Math.round(S.W*.035),gap=Math.round(S.W*.02); x.fillStyle="#fff"; x.fillRect(0,0,S.W,S.H); const bh=Math.round(S.H*(Number(P.options.bannerH)/100)); const g=x.createLinearGradient(0,0,S.W,0); g.addColorStop(0,P.options.bannerL); g.addColorStop(1,P.options.bannerR); x.fillStyle=g; x.fillRect(0,0,S.W,bh); if(P.images.logo){let li=new Image();li.src=P.images.logo; li.onload=()=>{const lh=Math.min(bh*.72,Math.round(S.W*.08)),lw=lh*(li.width/li.height),lx=pad,ly=Math.round((bh-lh)/2); x.save(); rr(lx,ly,lw,lh,8); x.clip(); x.drawImage(li,lx,ly,lw,lh); x.restore();};}
    const T={title:P.fields.cn.title||'专业级厨具', sub:P.fields.cn.sub||'美味只需一个按钮', right:P.fields.cn.rightTitle||'双灶台 · 高效燃烧', feats:wrap(P.fields.cn.features), listTitle:P.fields.cn.listTitle||'系列产品一览', caps:wrap(P.fields.cn.captions)}; const o=th(); x.fillStyle='#fff'; x.textBaseline='alphabetic'; x.font='900 '+Math.round(bh*o.title)+'px system-ui, Noto Sans SC'; x.fillText(T.title, pad+(P.images.logo?Math.round(bh*.85):0)+16, Math.round(bh*.66)); x.fillStyle='rgba(255,255,255,.92)'; x.font='400 '+Math.round(bh*o.sub)+'px system-ui, Noto Sans SC'; x.fillText(T.sub, pad+(P.images.logo?Math.round(bh*.85):0)+16, Math.round(bh*.92)); const bodyTop=bh+pad, bodyH=S.H-bh-pad*2, listH=Math.round(bodyH*.30), topH=bodyH-listH-gap; let lr=P.options.split.split(":"), L=+lr[0], R=+lr[1]; const tot=L+R; L/=tot; R/=tot; const leftW=Math.round((S.W-pad*2-gap)*L), rightW=Math.round((S.W-pad*2-gap)*R); const leftX=pad, leftY=bodyTop, leftH=topH; x.save(); rr(leftX,leftY,leftW,leftH,18); x.clip(); if(P.images.left){ draw(P.images.left,leftX,leftY,leftW,leftH);} else { x.fillStyle='#f1f5f9'; x.fillRect(leftX,leftY,leftW,leftH);} x.restore(); const rightX=pad+leftW+gap, rightY=bodyTop, rightH=topH; x.save(); rr(rightX,rightY,rightW,rightH,18); x.clip(); x.fillStyle='#f8fafc'; x.fillRect(rightX,rightY,rightW,rightH); x.fillStyle='#0f172a'; x.font='800 '+Math.round(S.W*o.right)+'px system-ui, Noto Sans SC'; x.fillText(T.right, rightX+Math.round(rightW*.08), rightY+Math.round(rightH*.14)); if(P.images.right){ let ri=new Image(); ri.src=P.images.right; ri.onload=()=>{ const px=rightX+Math.round(rightW*.1), pw=rightW-Math.round(rightW*.2), ph=pw*(ri.height/ri.width), py=rightY+Math.round(rightH*.18); x.drawImage(ri,px,py,pw,ph); const anchors=[{x:px+pw*.2,y:py+ph*.22},{x:px+pw*.78,y:py+ph*.18},{x:px+pw*.25,y:py+ph*.82},{x:px+pw*.83,y:py+ph*.72},{x:px+pw*.5,y:py+ph*.45},{x:px+pw*.12,y:py+ph*.58},{x:px+pw*.9,y:py+ph*.33},{x:px+pw*.62,y:py+ph*.9}]; const spots=[{x:rightX+28,y:rightY+48},{x:rightX+rightW-300,y:rightY+36},{x:rightX+28,y:rightY+rightH-36},{x:rightX+rightW-300,y:rightY+rightH-44},{x:rightX+28,y:rightY+rightH/2-6},{x:rightX+rightW-320,y:rightY+rightH/2+8},{x:rightX+rightW-320,y:rightY+rightH*.30},{x:rightX+60,y:rightY+rightH*.28}]; x.fillStyle='#0f172a'; x.font='600 '+Math.round(S.W*o.feature)+'px system-ui, Noto Sans SC'; T.feats.forEach((t,i)=>{ if(i>=anchors.length) return; const a=anchors[i], s=spots[i]; x.save(); x.beginPath(); x.arc(s.x-14,s.y-10,10,0,Math.PI*2); x.fillStyle='#0f172a'; x.fill(); x.fillStyle='#fff'; x.font='700 12px system-ui'; x.textAlign='center'; x.textBaseline='middle'; x.fillText(String(i+1), s.x-14, s.y-10+.5); x.restore(); x.textAlign='left'; x.fillText(t,s.x,s.y); x.save(); const d=[[6,6],[8,5],[5,7],[10,6]]; x.setLineDash(d[i%d.length]); x.strokeStyle='rgba(0,0,0,.6)'; x.lineWidth=2; x.beginPath(); x.moveTo(s.x-6,s.y-12); const wig=30+(i%5)*12; const mx=(s.x+a.x)/2+(i%2?-wig:wig); const my=(s.y+a.y)/2+(i%3===0?wig*.6:-wig*.4); x.quadraticCurveTo(mx,my,a.x,a.y); x.stroke(); x.setLineDash([]); x.beginPath(); x.arc(a.x,a.y,3,0,Math.PI*2); x.fill(); x.restore(); }); }; } x.restore(); const listTitleY=rightY+rightH+gap+Math.round(S.W*.02); x.fillStyle='#0f172a'; x.textAlign='center'; x.font='800 '+Math.round(S.W*.03)+'px system-ui, Noto Sans SC'; x.fillText(T.listTitle, S.W/2, listTitleY); x.textAlign='left'; const listX=Math.round(S.W*.035), listW=S.W-listX*2, listY=listTitleY+Math.round(S.W*.02); const max=Number(P.options.max), items=(P.images.list||[]).slice(0,max), spacing=Math.round(listW*.015), cols=Math.min(items.length||4,max), cellW=Math.floor((listW-spacing*(cols-1))/Math.max(cols,1)), hImg=Math.min(Math.round(S.W*.16),(S.H-listY-Math.round(S.W*.035))); items.forEach((src,i)=>{ const x0=listX+i*(cellW+spacing), y0=listY; x.save(); rr(x0,y0,cellW,hImg,12); x.clip(); draw(src,x0,y0,cellW,hImg); x.restore(); }); if(items.length){ x.fillStyle='#0f172a'; x.textAlign='center'; x.font='500 '+Math.round(S.W*.018)+'px system-ui, Noto Sans SC'; const gapCap=Math.round(S.W*.018); items.forEach((src,i)=>{ const x0=listX+i*(cellW+spacing); const cx=x0+cellW/2; const cy=listY+hImg+gapCap; const t=T.caps[i]||''; if(t){ x.fillText(t,cx,cy); } }); x.textAlign='left'; } }
  render();})();</scr'+'ipt></body></html>');
  const exporter=parts.join('');
  const blob=new Blob([exporter],{type:'text/html'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='poster.html'; a.click();
});

// 初始渲染，保证有占位
render();
})();
</script>
</body>
</html>
